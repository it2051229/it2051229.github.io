
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>My SeedIn Portfolio</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
    <link href="css/style.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>    
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <strong><a class="navbar-brand" href="#">My SeedIn Portfolio</a></strong>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="dashboard.html">Dashboard</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="investments.html">Investments</a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="mydata.html">My Data</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="about.html">About</a>
            </li>
        </ul>
    </div>
</nav>

<main role="main" class="container-fluid"><div class="row">
    <div class="col-md-6">
        <h2>My Data</h2>
        <p>
            You own your data and no one else can see it besides you. Your data is permanently stored on this specific web browser only. You can leave and continue working on it anytime.
        </p>
        <p>
            If you wish to work on your data in another computer/phone or web browser, you can export and download it as a file and import it again through this website.
        </p>
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <h2>Export</h2>
        <button class="btn btn-primary" onclick="exportData()">Download My Data</button>
        <p></p>
        <h2>Import</h2>
        <p>Restore a data from an exported file. This deletes whatever data you currently have.</p>
        <div class="custom-file">
            <input type="file" class="custom-file-input" id="importFile" onchange="importData()">
            <label class="custom-file-label" for="importFile">Choose file...</label>
        </div>
        <p></p>
    </div>
</div>
<div id="downloadArea"></div>
<script src="scripts/mydate.js"></script>
<script src="scripts/investment.js"></script>
<script src="scripts/database.js"></script>
<script>
    var database = new Database();

    // Export data to a file
    function exportData() {
        var investmentsJson = []
        var investments = database.getInvestments();

        // Serialize everything as a json object
        for(var i = 0; i < investments.length; i++)
            investmentsJson.push(investments[i].toJson());

        $("#downloadArea").html("<a id='download' download='seedin.data' href='data:text/plain;charset=utf-8," + encodeURIComponent(JSON.stringify(investmentsJson)) + "'></a>");
        $("#download")[0].click();
    }

    // Import data from file
    function importData() {
        if(!confirm("This will delete your current data, are you sure you want to continue?"))
            return;

        var fileReader = new FileReader();

        fileReader.onload = function() {
            try {
                if(database.importJson(JSON.parse(fileReader.result)))
                    alert("Import successful.");
                else
                    alert("Import failed.");
            } catch(err) {
                console.log(err);
                alert("Invalid file.");
            }
        }
        
        fileReader.readAsText($("#importFile")[0].files[0])
    }
</script>        
    </main>
</body>
</html>
